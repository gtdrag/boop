# Ralph Progress Log
Started: Mon Feb 16 20:30:55 CST 2026
---

## 2026-02-16 20:40 CST - Story 6.1
- Implemented project scaffolding from developer profile
- Created `src/scaffolding/generator.ts` — main scaffolding module with `scaffoldProject()` entry point
- Created `src/scaffolding/generator.test.ts` — 56 unit tests covering all profile combinations
- Files created: `src/scaffolding/generator.ts`, `src/scaffolding/generator.test.ts`
- **What was implemented:**
  - Profile-driven directory generation (base, frontend, backend, monorepo dirs)
  - package.json generation with framework deps, test runner, linter scripts
  - tsconfig.json generation with JSX support for React-based frameworks
  - Linter config generation (eslint.config.js, biome.json; oxlint is zero-config)
  - Test runner config generation (vitest.config.ts, jest.config.js)
  - CI config generation (GitHub Actions, GitLab CI, CircleCI) with package-manager-specific commands
  - .gitignore generation with standard entries
  - Git repo initialization with initial commit using profile name as author
  - Idempotency: won't overwrite existing files or re-init existing repos
- **Learnings for future iterations:**
  - scaffoldProject() takes a `skipGitInit` option for testability — avoids git init in test tmpDirs
  - Config generators return null when the feature is "none" or zero-config (like oxlint)
  - CI config uses filepath (with subdirs) vs filename for files like `.github/workflows/ci.yml`
  - execFileSync with env override for GIT_AUTHOR_NAME/GIT_COMMITTER_NAME works well for attribution
  - Frontend framework list for JSX detection: next, remix, vite-react, angular
---

## 2026-02-16 20:45 CST - Story 6.2
- Implemented SEO and analytics defaults for web projects
- Created `src/scaffolding/defaults/seo.ts` — SEO template generators (meta tags, OG tags, JSON-LD structured data, sitemap config, robots.txt)
- Created `src/scaffolding/defaults/analytics.ts` — Analytics provider wiring (Google Analytics, Plausible, PostHog, Mixpanel) + Core Web Vitals reporting
- Created `src/scaffolding/defaults/seo.test.ts` — 19 unit tests
- Created `src/scaffolding/defaults/analytics.test.ts` — 25 unit tests
- **What was implemented:**
  - `isWebProject()` helper checks frontendFramework !== "none"
  - React-based frameworks (next, remix, vite-react) get .tsx components; others get .ts helpers
  - Next.js-specific: app/sitemap.ts using MetadataRoute, built-in CWV support (no web-vitals dep)
  - All frameworks with public/ dir get robots.txt in public/
  - JSON-LD structured data helpers: WebSite and Organization schemas
  - Analytics: per-provider files with env-var-based configuration
  - `getAnalyticsDeps()` returns npm packages needed (posthog-js, mixpanel-browser, web-vitals)
  - GA and Plausible use script tags — no npm deps needed
- **Learnings for future iterations:**
  - seo.ts exports `isWebProject()` — reused by analytics.ts to avoid duplication
  - React frameworks share a component pattern (.tsx); non-React get utility modules (.ts)
  - Next.js has built-in sitemap and CWV support — different templates needed
  - Analytics providers that use script injection (GA, Plausible) don't need npm packages
  - PostHog and Mixpanel need npm packages (posthog-js, mixpanel-browser)
  - `generateSeoDefaults()` always returns exactly 5 files for web projects
  - `generateAnalyticsDefaults()` returns 2 files (provider + CWV) or 1 (CWV only when analytics=none)
---

## 2026-02-16 20:50 CST - Story 6.3
- Implemented accessibility and security header defaults for web projects
- Added `errorTracker` field to DeveloperProfile schema (type ErrorTracker: "sentry" | "bugsnag" | "none")
- Added errorTracker to DEFAULT_PROFILE (default: "sentry") and PROFILE_CATEGORIES
- Created `src/scaffolding/defaults/accessibility.ts` — accessibility template generators (skip-nav, ARIA landmarks, focus trap, color contrast checker)
- Created `src/scaffolding/defaults/security-headers.ts` — security header configs (CSP, HSTS, X-Frame-Options, X-Content-Type-Options) + error tracking setup (Sentry, Bugsnag)
- Created `src/scaffolding/defaults/accessibility.test.ts` — 16 unit tests
- Created `src/scaffolding/defaults/security-headers.test.ts` — 24 unit tests
- Updated `src/profile/schema.ts` — added ErrorTracker type and errorTracker field to DeveloperProfile
- Updated `src/profile/defaults.ts` — added errorTracker default and PROFILE_CATEGORIES entry
- **What was implemented:**
  - Skip-nav: React component (.tsx) for React frameworks, HTML builder (.ts) for others
  - ARIA landmarks: React layout component for React frameworks, HTML template builder for others
  - Focus trap: React hook (useFocusTrap) for React frameworks, utility (createFocusTrap) for others
  - Color contrast: WCAG 2.1 contrast ratio calculator with AA/AAA level checking (framework-independent)
  - Security headers: Next.js headers config, Express middleware, or generic headers map based on framework/backend
  - Error tracking: Sentry (@sentry/nextjs for Next, @sentry/node for others) and Bugsnag (@bugsnag/js)
  - `getSecurityDeps()` returns npm packages needed for error tracking provider
  - All security header variants include CSP, HSTS, X-Frame-Options, X-Content-Type-Options, Referrer-Policy, Permissions-Policy
- **Learnings for future iterations:**
  - Profile schema needed `errorTracker` field — added as a new type + field + default + category
  - React frameworks share component patterns (.tsx), non-React get utility modules (.ts) — same as SEO/analytics
  - Security headers config is determined by framework hierarchy: Next.js first, then Express, then generic
  - Color contrast checker is framework-independent — same implementation for all web projects
  - `generateAccessibilityDefaults()` always returns exactly 4 files for web projects
  - `generateSecurityHeaderDefaults()` returns 2 files (headers + tracker) or 1 (headers only when errorTracker=none)
---

## 2026-02-16 20:55 CST - Story 6.4
- Implemented agent sandboxing enforcement with Docker container isolation + policy engine
- Created `src/sandbox/policy.ts` — sandbox policy engine with command validation
- Created `src/sandbox/docker-runner.ts` — Docker-based sandbox runner with local fallback
- Created `src/sandbox/policy.test.ts` — 33 unit tests for policy engine
- Created `src/sandbox/docker-runner.test.ts` — 29 unit tests for Docker runner
- **What was implemented:**
  - Policy engine: evaluateCommand() validates commands against blocked commands, blocked git ops, destructive patterns, and path restrictions
  - Blocked commands: shutdown, reboot, halt, poweroff, init, mkfs, fdisk, dd, mount, umount, systemctl
  - Blocked git ops: push --force/-f, reset --hard, clean -f, branch -D
  - Destructive patterns: rm -rf on absolute paths, writes to block devices, chmod 000/777 on root
  - Path enforcement: isPathAllowed() restricts access to project dir + ~/.boop, prevents prefix-match escapes
  - Command parsing: extractBaseCommand() handles env vars, sudo (with -u flag args), pipes
  - Docker runner: SandboxRunner class with Docker isolation or local fallback, both enforce policy
  - Docker args: --rm, --read-only, --no-new-privileges, --pids-limit 256, memory/CPU limits, project dir bind mount
  - Network restrictions: buildNetworkRestrictionScript() generates iptables rules allowing only Claude API
  - SandboxPolicyViolation error class for denied commands
  - createPolicy() and createSandboxRunner() factory functions with sensible defaults
- **Learnings for future iterations:**
  - Policy engine runs BEFORE execution — denied commands never reach the shell/Docker
  - extractBaseCommand() must handle sudo flags that take arguments (-u user) — implemented with a Set of known flags
  - rm -rf pattern only blocks absolute paths (rm -rf /...) — relative paths like `rm -rf node_modules` are safe
  - Docker fallback mode still enforces the full policy engine — isolation is layered
  - isPathAllowed() uses `resolved.startsWith(normalizedProject + path.sep)` to prevent prefix-match escapes (e.g. /project-secrets matching /project)
  - vi.mock("node:child_process") with vi.hoisted() works well for mocking Docker availability
  - DEFAULT_ALLOWED_HOSTS only includes api.anthropic.com — expand for future API integrations
---

## 2026-02-16 20:56 CST - Story 6.5
- Implemented credential management and security audit checklist
- Created `src/security/credentials.ts` — credential store with file permissions (0600) and env var priority
- Created `src/security/audit-checklist.ts` — 7 programmatic security checks across 5 categories
- Created `src/security/credentials.test.ts` — 26 unit tests for credential store
- Created `src/security/audit-checklist.test.ts` — 19 unit tests for audit checklist
- Updated `src/security/index.ts` — re-exports from both new modules
- Updated `.gitignore` — added `.boop/` and `*.key` patterns for credential protection
- **What was implemented:**
  - CredentialStore interface: load, save, delete, exists, verifyPermissions
  - Load priority: env var (ANTHROPIC_API_KEY) > credential file (~/.boop/credentials/anthropic.key)
  - Save: creates directory with 0700, writes file with 0600 + explicit chmod
  - Leak detection: containsCredential() and scanFileForCredentials() for pattern matching
  - Audit categories: sandbox, credentials, logging, git-safety, leak-detection
  - Audit checks: sandbox policy exists, docker runner exists, credential permissions, credentials dir permissions, logger sanitization, .gitignore patterns, no credential leaks in source
  - formatAuditReport() generates human-readable report grouped by category
  - .gitignore updated to cover .boop/ and *.key patterns
- **Learnings for future iterations:**
  - Credential file permissions are set with both writeFileSync mode + explicit chmodSync — umask can override the mode flag alone
  - Credentials directory gets 0700 (owner-only access); files get 0600 (owner-read/write)
  - Audit checklist checks for file existence with fs.existsSync — simple and reliable
  - Audit leak scanner uses a recursive walkDir with configurable skip dirs (node_modules, .git, dist, etc.)
  - containsCredential() requires 20+ chars after sk-ant- prefix to avoid false positives on test code
  - When credential file doesn't exist, audit passes (env var fallback is a valid configuration)
  - Logger sanitization check looks for both "export function sanitize(" and usage of "sanitize(" — both must exist
---

## 2026-02-19 - Story 6.6
- Implemented project retrospective and self-improvement analysis
- Created `src/retrospective/analyzer.ts` — analyzes build history, review findings, iteration counts
- Created `src/retrospective/reporter.ts` — generates retrospective.md and cross-project memory YAML
- Created `src/retrospective/analyzer.test.ts` — 23 unit tests
- Created `src/retrospective/reporter.test.ts` — 22 unit tests
- Wired RETROSPECTIVE phase into pipeline runner between SIGN_OFF and COMPLETE
- **What was implemented:**
  - RetrospectiveData type with per-epic stats, pattern analysis, prompt quality metrics
  - analyzeProject() walks .boop/reviews/, progress.txt, git log for build metrics
  - generateReport() produces retrospective.md with statistics tables, failure patterns, suggestions
  - saveMemory() persists learnings to ~/.boop/memory/ as structured YAML
  - Pipeline runner calls retrospective after sign-off, non-fatal on failure
---

## 2026-02-19 - Epics 7-8: Self-Improvement Loop (10 stories)
- Implemented complete self-improvement system across 12 new files in `src/evolution/`
- **Stories completed:**
  - 7.1: Stack matcher + outcome injection logic (stack-matcher.ts, outcome-injector.ts)
  - 7.2: Wired outcome injection into planning (viability.ts, prd.ts, architecture.ts, stories.ts, orchestrator.ts)
  - 7.3: Architecture decisions core (arch-decisions.ts — store, merge, query, format, extract)
  - 7.4: Arch decision extraction + pipeline integration (runner.ts RETROSPECTIVE section)
  - 8.1: Prompt version history (prompt-history.ts — save, load, rollback, list versions)
  - 8.2: Prompt evolution core (prompt-evolver.ts — generate proposals, validate via benchmark, promote)
  - 8.3: Evolution pipeline integration (runner.ts, profile schema autoEvolvePrompts flag)
  - 8.4: Consolidation core (consolidator.ts — heuristics with staleness decay)
  - 8.5: Consolidation pipeline integration + heuristic injection into planning prompts
- **Files created:** 12 (6 source + 6 test files in src/evolution/)
- **Files modified:** 9 (4 planning modules, orchestrator, runner, profile schema, benchmark commands, structural test)
- **New tests:** 75 evolution tests, 1497 total passing
- Also includes adversarial review infrastructure: approval-gate.ts, review-rules.ts, risk-policy.ts + tests
- **Learnings for future iterations:**
  - extractStackKeywords must be defensive — profile fields can be undefined in test mocks
  - planning/ now legitimately imports from review/ (ReviewRule type) — structural test updated
  - All evolution features are backward-compatible: optional params, missing YAML = empty store, failures are non-fatal
  - Consolidation uses staleness decay: confidence drops 0.05/month, pruned below 0.3
  - Prompt evolution gated on profile.autoEvolvePrompts (default false) + baseline benchmark existence
  - Team-based parallel implementation effective: 3 agents built independent stories simultaneously
---
