# Ralph Progress Log
Started: Mon Feb 16 15:52:58 CST 2026

## Codebase Patterns
- DeveloperProfile canonical definition lives in src/profile/schema.ts — re-exported through src/shared/types.ts and src/shared/index.ts
- Profile categories defined in src/profile/defaults.ts — PROFILE_CATEGORIES array used by onboarding flow
- Union types with `| string` escape hatch allow custom values beyond predefined options
- ProfileCategory.multi flag indicates array fields (e.g. languages) vs single-value fields
- DEFAULT_PROFILE provides the recommended value for every field — PROFILE_CATEGORIES.recommended mirrors these
- Onboarding flow in src/profile/onboarding.ts — runOnboarding() for new, loadProfile() to read existing
- config/index.ts exports runOnboarding() and editProfile() that delegate to profile/onboarding.ts
- CLI --profile flag: calls runOnboarding (no profile) or editProfile (profile exists)
- PipelineOrchestrator accepts optional DeveloperProfile — getProfile()/requireProfile() for access
- loadProfileFromDisk() in config/index.ts reads ~/.boop/profile.yaml synchronously (uses yaml package)
- Pipeline refuses to start (IDLE → PLANNING) without a loaded profile — requireProfile() guard
- CLI loads profile after onboarding via loadProfileFromDisk() and passes to all orchestrator instances
- Prompt messages show "(current)" when editing existing values, "(recommended)" for new onboarding
- @clack/prompts mocking pattern: mock text/multiselect/confirm with response queues, use symbol for cancel

---

## 2026-02-16 15:56 - Story 2.1
- What was implemented:
  - Created src/profile/schema.ts — full DeveloperProfile interface covering all required categories: frontendFramework, backendFramework, database, cloudProvider, styling, stateManagement, analytics, ciCd, languages, projectStructure, packageManager, testRunner, linter, aiModel, autonomousByDefault
  - Created typed unions for each category (FrontendFramework, BackendFramework, Database, etc.) with `| string` escape hatch for custom values
  - Created ProfileCategory interface for onboarding metadata (key, label, recommended, alternatives, multi)
  - Created src/profile/defaults.ts — DEFAULT_PROFILE with opinionated modern defaults (Next.js, Express, PostgreSQL, Vercel, Tailwind, Zustand, PostHog, GitHub Actions, pnpm, vitest, oxlint, monorepo)
  - Created PROFILE_CATEGORIES ordered list for onboarding interview — each entry has recommended value and alternatives
  - Updated src/shared/types.ts — replaced stub DeveloperProfile with re-export from profile/schema.ts
  - Updated src/shared/index.ts — added ProfileCategory re-export
  - Updated src/shared/types.test.ts — updated DeveloperProfile test to match new expanded schema
  - Created src/profile/schema.test.ts — 4 tests (full profile construction, custom values, ProfileCategory shape, multi flag)
  - Created src/profile/defaults.test.ts — 9 tests (all fields present, modern defaults verified, categories cover all fields, categories have labels/alternatives, recommended matches defaults, languages is multi-select)
  - All 104 tests passing, typecheck clean, 0 lint errors
- Files changed:
  - src/profile/schema.ts — new (DeveloperProfile, ProfileCategory, all union types)
  - src/profile/defaults.ts — new (DEFAULT_PROFILE, PROFILE_CATEGORIES)
  - src/profile/schema.test.ts — new (4 tests)
  - src/profile/defaults.test.ts — new (9 tests)
  - src/shared/types.ts — updated (replaced stub with re-export)
  - src/shared/index.ts — updated (added ProfileCategory export)
  - src/shared/types.test.ts — updated (expanded DeveloperProfile test)
- **Learnings for future iterations:**
  - Using `| string` on union types allows users to specify custom tools not in the predefined list — good for extensibility without sacrificing type-safety for known values
  - Re-exporting types from shared/types.ts keeps downstream imports stable while moving canonical definitions to domain modules
  - ProfileCategory metadata enables data-driven onboarding — iterate over PROFILE_CATEGORIES instead of hardcoding each prompt
---

## 2026-02-16 16:01 - Story 2.2
- What was implemented:
  - Created src/profile/onboarding.ts — full interactive interview flow using @clack/prompts
  - runOnboarding() iterates over PROFILE_CATEGORIES, prompting each field with opinionated defaults
  - Supports three prompt types: text (single-value), multiselect (languages), confirm (boolean)
  - Each prompt shows "Category? recommended (recommended)" pattern — enter accepts, typing overrides
  - Supports pre-populated values via existingProfile option (for editing in 2.3)
  - loadProfile() reads and parses existing ~/.boop/profile.yaml
  - Saves profile as YAML using the `yaml` package
  - Updated src/config/index.ts — added runOnboarding() and editProfile() exports that delegate to profile/onboarding.ts
  - Kept runOnboardingStub() as deprecated for backward compat
  - Updated src/cli/program.ts — --profile flag now calls real onboarding/editing flow
  - First-run auto-onboarding now uses real interactive flow (not stub)
  - Created src/profile/onboarding.test.ts — 12 tests covering: defaults, overrides, YAML persistence, cancellation, pre-populated editing, multi-select, boolean confirm, directory creation
  - Updated src/cli/program.test.ts — mock config module to avoid interactive prompts, test --profile dispatches correctly
  - All 117 tests passing, typecheck clean, 0 lint errors
- Files changed:
  - src/profile/onboarding.ts — new (runOnboarding, loadProfile, OnboardingOptions, OnboardingResult)
  - src/profile/onboarding.test.ts — new (12 tests)
  - src/config/index.ts — updated (added runOnboarding, editProfile exports)
  - src/cli/program.ts — updated (wired real onboarding into --profile and first-run)
  - src/cli/program.test.ts — updated (mock config module, test onboarding dispatch)
- **Learnings for future iterations:**
  - @clack/prompts can be mocked by providing vi.fn() implementations for text/multiselect/confirm + response queues
  - Use symbol for cancel detection: `const CANCEL = Symbol("cancel")` and `isCancel: (v) => v === CANCEL`
  - Dynamic import (`await import("@clack/prompts")`) inside functions works well with vitest mocking
  - Profile YAML round-tripping works cleanly with the `yaml` package (parse/stringify)
  - Pre-populating existing values for editing just requires passing existingProfile to runOnboarding
---

## 2026-02-16 16:06 - Story 2.3
- What was implemented:
  - Updated prompt messages in src/profile/onboarding.ts to distinguish "(current)" vs "(recommended)" tags
  - promptSingleValue: shows "(current)" when editing existing values, "(recommended)" for new onboarding
  - promptName: shows "Your name? ExistingName (current)" when editing, "What's your name?" for new
  - promptBoolean: appends "(current)" when editing existing boolean values
  - Added 6 new tests in src/profile/onboarding.test.ts covering the editing flow (Story 2.3):
    - Shows "current" tag for existing values in single-value prompts
    - Shows "recommended" tag for new onboarding prompts
    - Preserves unchanged values when accepting all defaults during edit
    - Allows changing specific values during edit (with file persistence verification)
    - Overwrites existing profile.yaml on save
    - Full round-trip: load → edit → save → reload
  - CLI wiring was already complete from Story 2.2 (--profile → editProfile when profile exists)
  - All 123 tests passing, typecheck clean, 0 lint errors
- Files changed:
  - src/profile/onboarding.ts — updated (prompt message tags: current vs recommended)
  - src/profile/onboarding.test.ts — updated (6 new editing tests)
- **Learnings for future iterations:**
  - Story 2.2 built the editing infrastructure proactively via existingProfile option — Story 2.3 mostly needed UX polish and dedicated test coverage
  - When mock response queues are empty, the mock falls through to defaultValue — useful for "accept all defaults" test scenarios
  - Distinguishing "current" vs "recommended" in prompts prevents confusing users during edit mode
---

## 2026-02-16 16:13 - Story 2.4
- What was implemented:
  - Added DeveloperProfile integration to PipelineOrchestrator — constructor accepts optional profile, stored as private field
  - Added getProfile() (returns profile or null) and requireProfile() (throws if missing) methods
  - Added profile guard on transition(): IDLE → any non-IDLE phase requires a loaded profile
  - Updated formatStatus() — includes "Profile: name" line when profile is loaded
  - Updated formatResumeContext() — includes "Profile: name" line when profile is loaded
  - Added loadProfileFromDisk() to src/config/index.ts — synchronous YAML profile reader using `yaml` package
  - Updated src/cli/program.ts — loads profile via loadProfileFromDisk() after onboarding, passes to PipelineOrchestrator instances
  - Added profile-required guard in CLI: if no profile loaded when idea is provided, prints error and returns
  - Updated 14 existing orchestrator tests to pass TEST_PROFILE (profile now required for transitions)
  - Added 13 new profile integration tests in orchestrator.test.ts (getProfile, requireProfile, transition guard, advance guard, formatStatus/formatResumeContext with/without profile, full phase traversal)
  - Added 3 new loadProfileFromDisk tests in config.test.ts (missing file, valid YAML, non-existent dir)
  - Added 2 new CLI tests (refuses without profile, starts with profile) and updated mock pattern
  - All 141 tests passing, typecheck clean, 0 lint errors
- Files changed:
  - src/pipeline/orchestrator.ts — updated (profile field, getProfile, requireProfile, transition guard, formatStatus, formatResumeContext)
  - src/pipeline/orchestrator.test.ts — updated (TEST_PROFILE fixture, 14 existing tests updated, 13 new profile integration tests)
  - src/config/index.ts — updated (new loadProfileFromDisk export, yaml import)
  - src/config/config.test.ts — updated (3 new loadProfileFromDisk tests)
  - src/cli/program.ts — updated (loadProfileFromDisk import, profile loading, profile guard on idea, profile passed to orchestrators)
  - src/cli/program.test.ts — updated (loadProfileFromDisk mock, beforeEach reset, 2 new tests, mock pattern fix)
- **Learnings for future iterations:**
  - vi.clearAllMocks() does NOT reset mockReturnValue — use vi.resetAllMocks() and re-set defaults in beforeEach
  - When adding a required param to a constructor, all existing tests that call that constructor need updating — batch this early
  - loadProfileFromDisk uses synchronous yaml.parse — fine for CLI startup, avoids async complexity in constructors
  - Profile guard is at the orchestrator level (requireProfile on transition) AND CLI level (guard before starting pipeline) — defense in depth
---
